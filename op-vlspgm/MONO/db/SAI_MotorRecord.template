#! Generated by VisualDCT v2.6
#! DBDSTART
#! DBDEND


# V0.4
# Macro explanations
#ASYNPORTasyn port
#PMACPORTpmac asyn motor port	
#TMOTasyn record timeout (sec)
#PMAC_MTRmotor on PMAC
#SCANscan intervall
#Pprefix of the pv name
#Rmain part of the pv name
#AXISname of the motor axis
#DESCaxis description
#MRESaxis resolution (egu's per count)
#PRECprecision
#EGUengineering unit
#VELvelocity (egu/sec)
#TACCacceleration time (sec)
#HSLMpositive software limit
#LSLMnegative software limit
record(motor, "$(P)$(R)$(AXIS)") {
  field(DESC, "$(DESC)")
  field(DTYP, "asynMotor")
  field(DIR, "0")
## O=pos, 1=neg
  field(VELO, "$(VEL)")
## egu velocity
  field(VBAS, "0")
## base egu velocity
  field(ACCL, "$(TACC)")
## tacc (sec)
  field(BDST, "0")
## backlash dist (EGU)
  field(BVEL, "0")
## backlash speed (EGU)
  field(BACC, "0")
## backlash tacc (sec)
  field(OUT, "@asyn($(PMACPORT),$(PMAC_MTR))")
  field(MRES, "$(MRES)")
  field(RRES, "1")
  field(PREC, "$(PREC)")
  field(EGU, "$(EGU)")
  field(URIP, "0")
  field(UEIP, "1")
  field(RTRY, "0")
## max. number of retries
  field(SYNC, "1")
  field(DHLM, "$(HSLM)")
  field(DLLM, "$(LSLM)")
  field(OFF, "$(OFFS)")
  info(autosaveFields, "VELO ACCL OFF DHLM DLLM")
}

record(busy, "$(P)$(R)$(AXIS)_BUSY_STS") {
  field(DESC, "Busy record for sscan")
}

record(calcout, "$(P)$(R)$(AXIS)_SET_BUSY") {
  field(DESC, "Set busy record")
  field(INPA, "$(P)$(R)$(AXIS).DMOV CP")
  field(CALC, "A")
  field(OCAL, "1")
  field(OOPT, "Transition To Zero")
  field(DOPT, "Use OCAL")
  field(OUT, "$(P)$(R)$(AXIS)_BUSY_STS CA")
}

record(calcout, "$(P)$(R)$(AXIS)_CLR_BUSY") {
  field(DESC, "Clear busy record")
  field(INPA, "$(P)$(R)$(AXIS).DMOV CP")
  field(CALC, "A")
  field(OOPT, "Transition To Non-zero")
  field(DOPT, "Use OCAL")
  field(OUT, "$(P)$(R)$(AXIS)_BUSY_STS CA")
}

record(transform, "$(P)$(R)$(AXIS)_ableput") {
  field(CLCB, "a")
  field(CLCC, "a")
  field(OUTB, "$(P)$(R)$(AXIS).DISP NPP NMS")
  field(OUTC, "$(P)$(R)$(AXIS).DISA NPP NMS")
}

record(bo, "$(P)$(R)$(AXIS)_able") {
  field(DESC, "motor enable")
  field(PINI, "YES")
  field(OUT, "$(P)$(R)$(AXIS)_ableput.A PP MS")
  field(ZNAM, "Enable")
  field(ONAM, "Disable")
}

record(scalcout, "$(P)$(R)$(AXIS)_TWV_CHECK") {
  field(DESC, "Check and change TWV")
  field(INPC, "$(P)$(R)$(AXIS).MRES")
  field(INPD, "$(P)$(R)$(AXIS).HLM")
  field(INPE, "$(P)$(R)$(AXIS).LLM")
  field(CALC, "min(max(a,c),d-e)")
  field(OUT, "$(P)$(R)$(AXIS).TWV")
  field(PREC, "3")
  field(EGU, "mm")
}

record(stringout, "$(P)$(R)$(AXIS)_KILL_CMD") {
  field(DESC, "Kill/disable motor")
  field(DTYP, "stream")
  field(OUT, "@devPmacStreamSAI.proto sendCommand(#$(PMAC_MTR)k) $(ASYNPORT)")
}

record(stringout, "$(P)$(R)$(AXIS)_ENA_CMD") {
  field(DESC, "Kill/disable motor")
  field(DTYP, "stream")
  field(OUT, "@devPmacStreamSAI.proto sendCommand(#$(PMAC_MTR)J/) $(ASYNPORT)")
}

record(bo, "$(P)$(R)$(AXIS)_ST_CMD") {
  field(DESC, "Stop Command")
  field(VAL, "1")
  field(OUT, "$(P)$(R)$(AXIS).STOP PP")
}

record(ai, "$(P)$(R)$(AXIS)_MON") {
  field(DESC, "Position Readback")
  field(PREC, "$(PREC)")
  field(EGU, "$(EGU)")
  field(INP, "$(P)$(R)$(AXIS).RBV CP")
}

record(ao, "$(P)$(R)$(AXIS)_SP") {
  field(DESC, "New Position Setpoint")
  field(PREC, "$(PREC)")
  field(EGU, "$(EGU)")
  field(OUT, "$(P)$(R)$(AXIS).VAL PP")
}

record(ao, "$(P)$(R)$(AXIS)_POS_SP") {
  field(DESC, "New Position Setpoint")
  field(PREC, "$(PREC)")
  field(EGU, "$(EGU)")
  info(autosaveFields, "VAL")
}

record(calcout, "$(P)$(R)$(AXIS)_MOVE_CMD") {
  field(DESC, "Enable motor")
  field(INPA, "$(P)$(R)$(AXIS)_LOOPM_STS NPP NMS")
  field(CALC, "A")
  field(OOPT, "When Non-zero")
  field(OCAL, "1")
  field(OUT, "$(P)$(R)$(AXIS)_ENA_CMD.PROC")
  field(FLNK, "$(P)$(R)$(AXIS)_MOVE2_CMD")
}

record(calcout, "$(P)$(R)$(AXIS)_MOVE2_CMD") {
  field(DESC, "Start movement")
  field(PREC, "$(PREC)")
  field(EGU, "$(EGU)")
  field(INPA, "$(P)$(R)$(AXIS)_POS_SP NPP NMS")
  field(CALC, "A")
  field(OOPT, "Every Time")
  field(OUT, "$(P)$(R)$(AXIS).VAL PP")
}

record(ao, "$(P)$(R)$(AXIS)_TWK_SP") {
  field(DESC, "Tweak Value")
  field(PREC, "$(PREC)")
  field(EGU, "$(EGU)")
  info(autosaveFields, "VAL")
}

record(calcout, "$(P)$(R)$(AXIS)_TWK_CMD") {
  field(DESC, "Tweak Forward/Reverse")
  field(PREC, "$(PREC)")
  field(EGU, "$(EGU)")
  field(INPA, "$(P)$(R)$(AXIS)_POS_SP NPP NMS")
  field(INPB, "$(P)$(R)$(AXIS)_TWK_SP NPP NMS")
  field(INPC, "$(P)$(R)$(AXIS).RBV NPP NMS")
  field(INPD, "0")
  field(INPE, "$(P)$(R)$(AXIS)_TWK_MODE NPP NMS")
  field(CALC, "E=1?A+(B*D):C+(B*D)")
# tweak based on setpoint or actual position
  field(OOPT, "Every Time")
  field(OUT, "$(P)$(R)$(AXIS)_POS_SP PP")
  field(FLNK, "$(P)$(R)$(AXIS)_MOVE_CMD PP")
}

record(bo, "$(P)$(R)$(AXIS)_TWK_MODE") {
  field(DESC, "Set Tweak Mode")
  field(VAL, "0")
  field(ZNAM, "Tweak Position")
  field(ONAM, "Tweak Setpoint")
  info(autosaveFields, "VAL")
}

record(ai, "$(P)$(R)$(AXIS)_VL_MON") {
  field(DESC, "Velocity monitor for scan")
  field(PREC, "$(PREC)")
  field(EGU, "$(EGU)")
  field(INP, "$(P)$(R)$(AXIS).VELO CP")
}

#! Further lines contain data used by VisualDCT
#! View(337,216,0.5)
#! Record("$(P)$(R)$(AXIS)",1960,944,0,0,"$(P)$(R)$(AXIS)")
#! Field("$(P)$(R)$(AXIS).DMOV",16777215,1,"$(P)$(R)$(AXIS).DMOV")
#! Field("$(P)$(R)$(AXIS).DISA",16777215,0,"$(P)$(R)$(AXIS).DISA")
#! Field("$(P)$(R)$(AXIS).DISP",16777215,0,"$(P)$(R)$(AXIS).DISP")
#! Field("$(P)$(R)$(AXIS).MRES",16777215,1,"$(P)$(R)$(AXIS).MRES")
#! Field("$(P)$(R)$(AXIS).HLM",16777215,0,"$(P)$(R)$(AXIS).HLM")
#! Field("$(P)$(R)$(AXIS).LLM",16777215,0,"$(P)$(R)$(AXIS).LLM")
#! Field("$(P)$(R)$(AXIS).TWV",16777215,0,"$(P)$(R)$(AXIS).TWV")
#! Field("$(P)$(R)$(AXIS).STOP",16777215,0,"$(P)$(R)$(AXIS).STOP")
#! Field("$(P)$(R)$(AXIS).VELO",16777215,1,"$(P)$(R)$(AXIS).VELO")
#! Field("$(P)$(R)$(AXIS).RBV",16777215,1,"$(P)$(R)$(AXIS).RBV")
#! Field("$(P)$(R)$(AXIS).VAL",16777215,0,"$(P)$(R)$(AXIS).VAL")
#! Record("$(P)$(R)$(AXIS)_BUSY_STS",2520,894,0,0,"$(P)$(R)$(AXIS)_BUSY_STS")
#! Field("$(P)$(R)$(AXIS)_BUSY_STS.VAL",16777215,0,"$(P)$(R)$(AXIS)_BUSY_STS.VAL")
#! Record("$(P)$(R)$(AXIS)_SET_BUSY",2240,692,0,0,"$(P)$(R)$(AXIS)_SET_BUSY")
#! Field("$(P)$(R)$(AXIS)_SET_BUSY.INPA",16777215,0,"$(P)$(R)$(AXIS)_SET_BUSY.INPA")
#! Link("$(P)$(R)$(AXIS)_SET_BUSY.INPA","$(P)$(R)$(AXIS).DMOV")
#! Field("$(P)$(R)$(AXIS)_SET_BUSY.OUT",16777215,1,"$(P)$(R)$(AXIS)_SET_BUSY.OUT")
#! Link("$(P)$(R)$(AXIS)_SET_BUSY.OUT","$(P)$(R)$(AXIS)_BUSY_STS.VAL")
#! Record("$(P)$(R)$(AXIS)_CLR_BUSY",2240,926,0,0,"$(P)$(R)$(AXIS)_CLR_BUSY")
#! Field("$(P)$(R)$(AXIS)_CLR_BUSY.INPA",16777215,0,"$(P)$(R)$(AXIS)_CLR_BUSY.INPA")
#! Link("$(P)$(R)$(AXIS)_CLR_BUSY.INPA","$(P)$(R)$(AXIS).DMOV")
#! Field("$(P)$(R)$(AXIS)_CLR_BUSY.OUT",16777215,1,"$(P)$(R)$(AXIS)_CLR_BUSY.OUT")
#! Link("$(P)$(R)$(AXIS)_CLR_BUSY.OUT","$(P)$(R)$(AXIS)_BUSY_STS.VAL")
#! Record("$(P)$(R)$(AXIS)_ableput",1600,912,0,0,"$(P)$(R)$(AXIS)_ableput")
#! Field("$(P)$(R)$(AXIS)_ableput.OUTC",16777215,1,"$(P)$(R)$(AXIS)_ableput.OUTC")
#! Link("$(P)$(R)$(AXIS)_ableput.OUTC","$(P)$(R)$(AXIS).DISA")
#! Field("$(P)$(R)$(AXIS)_ableput.OUTB",16777215,1,"$(P)$(R)$(AXIS)_ableput.OUTB")
#! Link("$(P)$(R)$(AXIS)_ableput.OUTB","$(P)$(R)$(AXIS).DISP")
#! Field("$(P)$(R)$(AXIS)_ableput.A",16777215,1,"$(P)$(R)$(AXIS)_ableput.A")
#! Record("$(P)$(R)$(AXIS)_able",1340,940,0,0,"$(P)$(R)$(AXIS)_able")
#! Field("$(P)$(R)$(AXIS)_able.OUT",16777215,1,"$(P)$(R)$(AXIS)_able.OUT")
#! Link("$(P)$(R)$(AXIS)_able.OUT","$(P)$(R)$(AXIS)_ableput.A")
#! Record("$(P)$(R)$(AXIS)_TWV_CHECK",2240,1178,0,0,"$(P)$(R)$(AXIS)_TWV_CHECK")
#! Field("$(P)$(R)$(AXIS)_TWV_CHECK.INPC",16777215,0,"$(P)$(R)$(AXIS)_TWV_CHECK.INPC")
#! Link("$(P)$(R)$(AXIS)_TWV_CHECK.INPC","$(P)$(R)$(AXIS).MRES")
#! Field("$(P)$(R)$(AXIS)_TWV_CHECK.INPD",16777215,0,"$(P)$(R)$(AXIS)_TWV_CHECK.INPD")
#! Link("$(P)$(R)$(AXIS)_TWV_CHECK.INPD","$(P)$(R)$(AXIS).HLM")
#! Field("$(P)$(R)$(AXIS)_TWV_CHECK.INPE",16777215,0,"$(P)$(R)$(AXIS)_TWV_CHECK.INPE")
#! Link("$(P)$(R)$(AXIS)_TWV_CHECK.INPE","$(P)$(R)$(AXIS).LLM")
#! Field("$(P)$(R)$(AXIS)_TWV_CHECK.OUT",16777215,0,"$(P)$(R)$(AXIS)_TWV_CHECK.OUT")
#! Link("$(P)$(R)$(AXIS)_TWV_CHECK.OUT","$(P)$(R)$(AXIS).TWV")
#! Record("$(P)$(R)$(AXIS)_KILL_CMD",1000,1046,0,0,"$(P)$(R)$(AXIS)_KILL_CMD")
#! Record("$(P)$(R)$(AXIS)_ENA_CMD",1000,926,0,0,"$(P)$(R)$(AXIS)_ENA_CMD")
#! Record("$(P)$(R)$(AXIS)_ST_CMD",1600,1186,0,0,"$(P)$(R)$(AXIS)_ST_CMD")
#! Field("$(P)$(R)$(AXIS)_ST_CMD.OUT",16777215,1,"$(P)$(R)$(AXIS)_ST_CMD.OUT")
#! Link("$(P)$(R)$(AXIS)_ST_CMD.OUT","$(P)$(R)$(AXIS).STOP")
#! Record("$(P)$(R)$(AXIS)_MON",2440,1512,0,0,"$(P)$(R)$(AXIS)_MON")
#! Field("$(P)$(R)$(AXIS)_MON.INP",16777215,0,"$(P)$(R)$(AXIS)_MON.INP")
#! Link("$(P)$(R)$(AXIS)_MON.INP","$(P)$(R)$(AXIS).RBV")
#! Record("$(P)$(R)$(AXIS)_SP",1620,1912,0,0,"$(P)$(R)$(AXIS)_SP")
#! Field("$(P)$(R)$(AXIS)_SP.OUT",16777215,1,"$(P)$(R)$(AXIS)_SP.OUT")
#! Link("$(P)$(R)$(AXIS)_SP.OUT","$(P)$(R)$(AXIS).VAL")
#! Record("$(P)$(R)$(AXIS)_POS_SP",1040,1660,0,0,"$(P)$(R)$(AXIS)_POS_SP")
#! Field("$(P)$(R)$(AXIS)_POS_SP.SDIS",16777215,0,"$(P)$(R)$(AXIS)_POS_SP.SDIS")
#! Link("$(P)$(R)$(AXIS)_POS_SP.SDIS","$(P)$(R)$(AXIS)_POS_SP/SDIS")
#! Field("$(P)$(R)$(AXIS)_POS_SP.VAL",16777215,1,"$(P)$(R)$(AXIS)_POS_SP.VAL")
#! Connector("$(P)$(R)$(AXIS)_POS_SP/SDIS",null,940,1760,16777215,"",3)
#! Record("$(P)$(R)$(AXIS)_MOVE_CMD",1640,1626,0,0,"$(P)$(R)$(AXIS)_MOVE_CMD")
#! Field("$(P)$(R)$(AXIS)_MOVE_CMD.INPA",16777215,0,"$(P)$(R)$(AXIS)_MOVE_CMD.INPA")
#! Link("$(P)$(R)$(AXIS)_MOVE_CMD.INPA","$(P)$(R)$(AXIS)_POS_SP.VAL")
#! Field("$(P)$(R)$(AXIS)_MOVE_CMD.OUT",16777215,1,"$(P)$(R)$(AXIS)_MOVE_CMD.OUT")
#! Link("$(P)$(R)$(AXIS)_MOVE_CMD.OUT","$(P)$(R)$(AXIS).VAL")
#! Field("$(P)$(R)$(AXIS)_MOVE_CMD.SDIS",16777215,0,"$(P)$(R)$(AXIS)_MOVE_CMD.SDIS")
#! Link("$(P)$(R)$(AXIS)_MOVE_CMD.SDIS","$(P)$(R)$(AXIS)_MOVE_CMD/SDIS")
#! Connector("$(P)$(R)$(AXIS)_MOVE_CMD/SDIS",null,1560,1880,16777215,"",3)
#! Record("$(P)$(R)$(AXIS)_TWK_SP",1000,1326,0,0,"$(P)$(R)$(AXIS)_TWK_SP")
#! Field("$(P)$(R)$(AXIS)_TWK_SP.VAL",16777215,1,"$(P)$(R)$(AXIS)_TWK_SP.VAL")
#! Record("$(P)$(R)$(AXIS)_TWK_CMD",1360,1198,0,0,"$(P)$(R)$(AXIS)_TWK_CMD")
#! Field("$(P)$(R)$(AXIS)_TWK_CMD.INPB",16777215,0,"$(P)$(R)$(AXIS)_TWK_CMD.INPB")
#! Link("$(P)$(R)$(AXIS)_TWK_CMD.INPB","$(P)$(R)$(AXIS)_TWK_SP.VAL")
#! Field("$(P)$(R)$(AXIS)_TWK_CMD.INPC",16777215,1,"$(P)$(R)$(AXIS)_TWK_CMD.INPC")
#! Link("$(P)$(R)$(AXIS)_TWK_CMD.INPC","$(P)$(R)$(AXIS).RBV")
#! Field("$(P)$(R)$(AXIS)_TWK_CMD.INPE",16777215,0,"$(P)$(R)$(AXIS)_TWK_CMD.INPE")
#! Link("$(P)$(R)$(AXIS)_TWK_CMD.INPE","$(P)$(R)$(AXIS)_TWK_MODE.VAL")
#! Field("$(P)$(R)$(AXIS)_TWK_CMD.SDIS",16777215,0,"$(P)$(R)$(AXIS)_TWK_CMD.SDIS")
#! Link("$(P)$(R)$(AXIS)_TWK_CMD.SDIS","$(P)$(R)$(AXIS)_TWK_CMD/SDIS")
#! Field("$(P)$(R)$(AXIS)_TWK_CMD.INPA",16777215,0,"$(P)$(R)$(AXIS)_TWK_CMD.INPA")
#! Link("$(P)$(R)$(AXIS)_TWK_CMD.INPA","$(P)$(R)$(AXIS)_POS_SP.VAL")
#! Field("$(P)$(R)$(AXIS)_TWK_CMD.OUT",16777215,0,"$(P)$(R)$(AXIS)_TWK_CMD.OUT")
#! Link("$(P)$(R)$(AXIS)_TWK_CMD.OUT","$(P)$(R)$(AXIS)_POS_SP.VAL")
#! Field("$(P)$(R)$(AXIS)_TWK_CMD.FLNK",16777215,1,"$(P)$(R)$(AXIS)_TWK_CMD.FLNK")
#! Link("$(P)$(R)$(AXIS)_TWK_CMD.FLNK","$(P)$(R)$(AXIS)_MOVE_CMD")
#! Connector("$(P)$(R)$(AXIS)_TWK_CMD/SDIS",null,1200,1560,16777215,"",3)
#! Record("$(P)$(R)$(AXIS)_TWK_MODE",800,1492,0,0,"$(P)$(R)$(AXIS)_TWK_MODE")
#! Field("$(P)$(R)$(AXIS)_TWK_MODE.VAL",16777215,1,"$(P)$(R)$(AXIS)_TWK_MODE.VAL")
#! Record("$(P)$(R)$(AXIS)_VL_MON",2440,1332,0,0,"$(P)$(R)$(AXIS)_VL_MON")
#! Field("$(P)$(R)$(AXIS)_VL_MON.INP",16777215,0,"$(P)$(R)$(AXIS)_VL_MON.INP")
#! Link("$(P)$(R)$(AXIS)_VL_MON.INP","$(P)$(R)$(AXIS).VELO")
